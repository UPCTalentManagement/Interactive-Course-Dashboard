<!-- This Dashboard is Developed By Dr Mahmoud Hesham Learning architect, eLearning & EdTech Innovator  -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="UPC Training Dashboard">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230066cc'>
    <rect x='3' y='3' width='7' height='7' rx='1'/>
    <rect x='14' y='3' width='7' height='7' rx='1'/>
    <rect x='3' y='14' width='7' height='7' rx='1'/>
    <rect x='14' y='14' width='7' height='7' rx='1'/>
    </svg>">
    <meta name="keywords" content="dashboard, analytics, metrics, reports, performance, monitoring">
    <meta name="author" content="Developed By Dr Mahmoud Hesham">
    
    <title>UPC Training Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .filters {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .filters h2 {
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .filter-group select {
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        /* 
        #################################
        */
        .filter-gridn {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .filter-groupn {
            display: flex;
            flex-direction: column;
        }

        .filter-groupn label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .filter-groupn select {
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s;
        }

        .filter-groupn select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        /* ################################ */
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
        }

        .chart-container h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3rem;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background-color: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            display: inline-block;
            min-width: 80px;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-progress {
            background: #fef3c7;
            color: #92400e;
        }

        .status-not-completed {
            background: #fee2e2;
            color: #991b1b;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                height: 250px;
            }
        }

        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
        footer {
            text-align: center;
            padding: 15px;
            color: white;
            font-size: 1.1rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>UPC LMS Dashboard</h1>
            <h2> Mohammed Omar Creative Ideas </h2> 
            <p>Monitor Course performance across all Cities, Districts and Supervisors</p>
        </div>

        <!-- Filters -->
        <div class="filters">
            <h2>
                <span class="icon">üîç</span>
                Filters
            </h2>
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="cityFilter">City</label>
                    <select id="cityFilter">
                        <option value="">All Cities</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="districtFilter">District</label>
                    <select id="districtFilter">
                        <option value="">All Districts</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="supervisorFilter">Supervisor</label>
                    <select id="supervisorFilter">
                        <option value="">All Supervisors</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="statusFilter">Status</label>
                    <select id="statusFilter">
                        <option value="">All Status</option>
                        <option value="Completed">Completed</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Not Completed">Not Completed</option>
                    </select>
                </div>
            </div>
            <div class="filter-gridn">
                <div class="filter-groupn">
                    <label for="cityFiltern">City</label>
                    <select id="cityFiltern">
                        <option value="">All Cities</option>
                    </select>
                </div>
                <div class="filter-groupn">
                    <label for="districtFiltern">District</label>
                    <select id="districtFiltern">
                        <option value="">All Districts</option>
                    </select>
                </div>
                <div class="filter-groupn">
                    <label for="supervisorFiltern">Supervisor</label>
                    <select id="supervisorFiltern">
                        <option value="">All Supervisors</option>
                    </select>
                </div>
                <div class="filter-groupn">
                    <label for="statusFiltern">Status</label>
                    <select id="statusFiltern">
                        <option value="">All Status</option>
                        <option value="Completedn">Completed</option>
                        <option value="In Progressn">In Progress</option>
                        <option value="Not Completedn">Not Completed</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-value" id="totalStudents">-</div>
                <div class="metric-label">üë• Total Students</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="completedStudents">-</div>
                <div class="metric-label">‚úÖ Completed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="completionRate">-</div>
                <div class="metric-label">üìä Completion Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="inProgressStudents">-</div>
                <div class="metric-label">‚è≥ In Progress</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="notStartedStudents">-</div>
                <div class="metric-label">‚ùå Not Started</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3>üìà Overall Completion Status</h3>
                <div class="chart-wrapper">
                    <canvas id="statusPieChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìä Completed vs Total by District</h3>
                <div class="chart-wrapper">
                    <canvas id="districtBarChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üåç Students by City</h3>
                <div class="chart-wrapper">
                    <canvas id="cityPieChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üë®‚Äç‚öïÔ∏è Students by Supervisor</h3>
                <div class="chart-wrapper">
                    <canvas id="supervisorPieChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìã Status Distribution by District</h3>
                <div class="chart-wrapper">
                    <canvas id="statusDistributionChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìÖ Completions Trend</h3>
                <div class="chart-wrapper">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Detailed Table -->
        <div class="table-container">
            <h3>üìã Student Details</h3>
            <table class="data-table" id="studentTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>City</th>
                        <th>District</th>
                        <th>Supervisor</th>
                        <th>Email</th>
                        <th>Completion Rate</th>
                        <th>Status</th>
                        <th>Date Completed</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody">
                    <tr>
                        <td colspan="8" class="loading">Loading data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <footer>
        Made with ‚ù§Ô∏è by Dr Mahmoud Hesham- 2025
    </footer>

    <script>
        // Data variables
        let completedRateData = [];
        let overviewData = [];
        let completionData = [];
        let currentData = [];
        let charts = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            showLoading();
            loadDataFromAppScript();
        });

        function showLoading() {
            document.getElementById('totalStudents').textContent = 'Loading...';
            document.getElementById('completedStudents').textContent = 'Loading...';
            document.getElementById('inProgressStudents').textContent = 'Loading...';
            document.getElementById('notStartedStudents').textContent = 'Loading...';
            document.getElementById('completionRate').textContent = 'Loading...';
        }

        // Load data from Google Apps Script
        function loadDataFromAppScript() {
            // Replace 'YOUR_WEBAPP_URL' with your actual Google Apps Script web app URL
            const webAppUrl = 'https://script.google.com/macros/s/AKfycbwRqbscTozKWki_AhHrtXfKCP2CamSas5gw3HT4BerEzG_yCQ8XzkrXQameHn9edKDx/exec';
            
            fetch(webAppUrl + '?action=getAllData')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        completedRateData = data.completedRateData;
                        overviewData = data.overviewData;
                        completionData = data.completionData;
                        currentData = [...completedRateData];
                        
                        console.log(overviewData);
                        
                        initializeDashboard();
                        
                    } else {
                        console.error('Error loading data:', data.error);
                        // Use fallback sample data for demo
                        loadSampleData();
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    // Use fallback sample data for demo
                    loadSampleData();
                });
        }

        // Fallback sample data for demo purposes
        function loadSampleData() {
            completedRateData = [
                { city: 'Jeddah', district: 'Dr. M Salem', supervisor: 'Dr. Ahmed Siddeg Moussa', pharmacyNo: '2551198', userId: 'ma_rahal@unitedpharmacy.sa', displayName: 'Mohamed Ahmed Mohamed Rahal', completionRate: '100%', status: 'Completed', completedDate: '2025-03-27' },
                { city: 'Jeddah', district: 'Dr. M Salem', supervisor: 'Dr. Ahmed Siddeg Moussa', pharmacyNo: '100250', userId: 'sz_aboalala@unitedpharmacy.sa', displayName: 'Sayed Zakaria Ahmed Abu Al-Alaa', completionRate: '100%', status: 'Completed', completedDate: '2025-04-13' },
                { city: 'Jeddah', district: 'Dr. M Salem', supervisor: 'Dr. Osama Eisa', pharmacyNo: '2021047', userId: 'aa_hasan@unitedpharmacy.sa', displayName: 'Alsayeed Abdullah Al-Sayed Hassan', completionRate: '100%', status: 'Completed', completedDate: '2025-04-14' },
                { city: 'Riyadh', district: 'Dr. Hussein', supervisor: 'Dr. Sara Ahmed', pharmacyNo: '2551199', userId: 'sa_ahmed@unitedpharmacy.sa', displayName: 'Sara Ahmed Ali', completionRate: '75%', status: 'In Progress', completedDate: '' },
                { city: 'Riyadh', district: 'Dr. Hussein', supervisor: 'Dr. Omar Hassan', pharmacyNo: '2551200', userId: 'oh_hassan@unitedpharmacy.sa', displayName: 'Omar Hassan Mohamed', completionRate: '0%', status: 'Not Completed', completedDate: '' },
                { city: 'Dammam', district: 'Dr. Diaa', supervisor: 'Dr. Fatima Al-Zahra', pharmacyNo: '2551201', userId: 'fz_alzahra@unitedpharmacy.sa', displayName: 'Fatima Al-Zahra Ibrahim', completionRate: '100%', status: 'Completed', completedDate: '2025-03-20' },
                { city: 'Jeddah', district: 'Dr. M Salem', supervisor: 'Dr. Ahmed Siddeg Moussa', pharmacyNo: '2551202', userId: 'am_ali@unitedpharmacy.sa', displayName: 'Ahmed Mohamed Ali', completionRate: '50%', status: 'In Progress', completedDate: '' },
                { city: 'Riyadh', district: 'Dr. Hussein', supervisor: 'Dr. Sara Ahmed', pharmacyNo: '2551203', userId: 'fs_hassan@unitedpharmacy.sa', displayName: 'Fatima Said Hassan', completionRate: '100%', status: 'Completed', completedDate: '2025-04-01' },
                { city: 'Dammam', district: 'Dr. Diaa', supervisor: 'Dr. Fatima Al-Zahra', pharmacyNo: '2551204', userId: 'mo_salem@unitedpharmacy.sa', displayName: 'Mohamed Omar Salem', completionRate: '25%', status: 'In Progress', completedDate: '' },
                { city: 'Jeddah', district: 'Dr. M Salem', supervisor: 'Dr. Osama Eisa', pharmacyNo: '2551205', userId: 'ah_ibrahim@unitedpharmacy.sa', displayName: 'Ahmad Hasan Ibrahim', completionRate: '0%', status: 'Not Completed', completedDate: '' }
            ];

            overviewData = [
                { supervisor: 'Dr. Diaa', completed: 93, inProgress: 128, notCompleted: 58, total: 279 },
                { supervisor: 'Dr. Hussein', completed: 140, inProgress: 171, notCompleted: 53, total: 364 },
                { supervisor: 'Dr. M Salem', completed: 66, inProgress: 224, notCompleted: 85, total: 375 },
            ];

            currentData = [...completedRateData];
            initializeDashboard();
        }

        function initializeDashboard() {
            initializeFilters();
            updateMetrics();
            initializeCharts();
            updateTable();
            setupFilterListeners();
        }

        function initializeFilters() {
            // Get unique values for filters
            const cities = [...new Set(completedRateData.map(item => item.city))];
            const districts = [...new Set(completedRateData.map(item => item.district))];
            const supervisors = [...new Set(completedRateData.map(item => item.supervisor))];

            // Populate filter dropdowns
            populateSelect('cityFilter', cities);
            populateSelect('districtFilter', districts);
            populateSelect('supervisorFilter', supervisors);
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            select.innerHTML = `<option value="">All ${selectId.replace('Filter', '')}s</option>`;
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        function setupFilterListeners() {
            ['cityFilter', 'districtFilter', 'supervisorFilter', 'statusFilter'].forEach(filterId => {
                document.getElementById(filterId).addEventListener('change', applyFilters);
            });
        }

        function applyFilters() {
            const cityFilter = document.getElementById('cityFilter').value;
            const districtFilter = document.getElementById('districtFilter').value;
            const supervisorFilter = document.getElementById('supervisorFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            currentData = completedRateData.filter(item => {
                return (!cityFilter || item.city === cityFilter) &&
                       (!districtFilter || item.district === districtFilter) &&
                       (!supervisorFilter || item.supervisor === supervisorFilter) &&
                       (!statusFilter || item.status === statusFilter);
            });

            updateMetrics();
            updateCharts();
            updateTable();
        }

        function updateMetrics() {
            // Calculate metrics based on filtered data
            const totalStudents = currentData.length;
            const totalCompleted = currentData.filter(item => item.status === 'Completed').length;
            const inProgress = currentData.filter(item => item.status === 'In Progress').length;
            const notCompleted = currentData.filter(item => item.status === 'Not Completed').length;
            const completionRate = totalStudents > 0 ? ((totalCompleted / totalStudents) * 100).toFixed(1) : 0;

            document.getElementById('totalStudents').textContent = totalStudents.toLocaleString();
            document.getElementById('completedStudents').textContent = totalCompleted.toLocaleString();
            document.getElementById('inProgressStudents').textContent = inProgress.toLocaleString();
            document.getElementById('notStartedStudents').textContent = notCompleted.toLocaleString();
            document.getElementById('completionRate').textContent = completionRate + '%';
        }

        function initializeCharts() {
            createStatusPieChart();
            createDistrictBarChart();
            createCityPieChart();
            createSupervisorPieChart();
            createStatusDistributionChart();
            createTimelineChart();
        }

        function updateCharts() {
            Object.values(charts).forEach(chart => {
                if (chart && chart.destroy) {
                    chart.destroy();
                }
            });
            initializeCharts();
        }


        function createDistrictBarChart() {
            const ctx = document.getElementById('districtBarChart').getContext('2d');

            // Show only 3 districts
            const districtData = overviewData.slice(0, 3);
            const labels = districtData.map(item => item.supervisor);

            const completedPercentages = districtData.map(item =>
                item.total > 0 ? Number(((item.completed / item.total) * 100).toFixed(2)) : 0
            );

            charts.districtBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completion %',
                        data: completedPercentages,
                        backgroundColor: '#10B981',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return context.parsed.y.toFixed(2) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: { color: '#f3f4f6' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // function createDistrictBarChart() {
        //     const ctx = document.getElementById('districtBarChart').getContext('2d');

        //     // Ensure we only show data for exactly 3 districts
        //     const districtData = overviewData.slice(0, 3);
        //     const labels = districtData.map(item => item.supervisor);
        //     const completedPercentages = districtData.map(item => 
        //         ((item.completed / item.total) * 100).toFixed(2)
        //     );
        //     console.log('District Data:', districtData);    
        //     console.log('Labels:', labels);
        //     console.log('Completed Percentages:', completedPercentages);

        //     charts.districtBar = new Chart(ctx, {
        //         type: 'bar',
        //         data: {
        //             labels: labels,
        //             datasets: [{
        //                 label: 'Completion %',
        //                 data: completedPercentages,
        //                 backgroundColor: '#10B981',
        //                 borderRadius: 5
        //             }]
        //         },
        //         options: {
        //             responsive: true,
        //             maintainAspectRatio: false,
        //             plugins: {
        //                 legend: { position: 'top' },
        //                 tooltip: {
        //                     callbacks: {
        //                         label: function (context) {
        //                             return context.raw + '%'; // show % in tooltip
        //                         }
        //                     }
        //                 }
        //             },
        //             scales: {
        //                 y: {
        //                     beginAtZero: true,
        //                     max: 100, // because we‚Äôre showing percentages
        //                     ticks: {
        //                         callback: function(value) {
        //                             return value + '%';
        //                         }
        //                     },
        //                     grid: { color: '#f3f4f6' }
        //                 },
        //                 x: { grid: { display: false } }
        //             }
        //         }
        //     });

            // charts.districtBar = new Chart(ctx, {
            //     type: 'bar',
            //     data: {
            //         labels: districtData.map(item => item.supervisor),
            //         datasets: [{
            //             label: 'Completed',
            //             data: districtData.map(item => item.completed),
            //             backgroundColor: '#10B981',
            //             borderRadius: 5
            //         }, {
            //             label: 'Total',
            //             data: districtData.map(item => item.total),
            //             backgroundColor: '#E5E7EB',
            //             borderRadius: 5
            //         }]
            //     },
            //     options: {
            //         responsive: true,
            //         maintainAspectRatio: false,
            //         plugins: {
            //             legend: {
            //                 position: 'top'
            //             }
            //         },
            //         scales: {
            //             y: {
            //                 beginAtZero: true,
            //                 grid: {
            //                     color: '#f3f4f6'
            //                 }
            //             },
            //             x: {
            //                 grid: {
            //                     display: false
            //                 }
            //             }
            //         }
            //     }
            // });
        //}

        // function createStatusPieChart() {
        //     const ctx = document.getElementById('statusPieChart').getContext('2d');
        //     const statusCounts = {
        //         'Completed': currentData.filter(item => item.status === 'Completed').length,
        //         'In Progress': currentData.filter(item => item.status === 'In Progress').length,
        //         'Not Completed': currentData.filter(item => item.status === 'Not Completed').length
        //     };

        //     charts.statusPie = new Chart(ctx, {
        //         type: 'pie',
        //         data: {
        //             labels: Object.keys(statusCounts),
        //             datasets: [{
        //                 data: Object.values(statusCounts),
        //                 backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
        //                 borderWidth: 2,
        //                 borderColor: '#ffffff'
        //             }]
        //         },
        //         options: {
        //             responsive: true,
        //             maintainAspectRatio: false,
        //             plugins: {
        //                 legend: {
        //                     position: 'bottom',
        //                     labels: {
        //                         padding: 20,
        //                         usePointStyle: true
        //                     }
        //                 }
        //             }
        //         }
        //     });
        // }
        function createStatusPieChart() {
            const ctx = document.getElementById('statusPieChart').getContext('2d');
            const statusCounts = {
                'Completed': currentData.filter(item => item.status === 'Completed').length,
                'In Progress': currentData.filter(item => item.status === 'In Progress').length,
                'Not Completed': currentData.filter(item => item.status === 'Not Completed').length
            };

            const total = Object.values(statusCounts).reduce((a, b) => a + b, 0);

            charts.statusPie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        datalabels: {
                            formatter: (value) => {
                                let percentage = (value / total * 100).toFixed(1) + '%';
                                return percentage;
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14
                            }
                        }
                    }
                },
                // plugins: [ChartDataLabels], // activate the plugin
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let value = context.raw;
                                let percentage = (value / total * 100).toFixed(1) + '%';
                                return context.label + ': ' + percentage;
                            }
                        }
                    }
                }
            });
        }

        function createDistrictBarChart() {
            const ctx = document.getElementById('districtBarChart').getContext('2d');
            
            charts.districtBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: overviewData.map(item => item.supervisor),
                    datasets: [{
                        label: 'Completed',
                        data: overviewData.map(item => item.completed),
                        backgroundColor: '#10B981',
                        borderRadius: 5
                    }, {
                        label: 'Total',
                        data: overviewData.map(item => item.total),
                        backgroundColor: '#E5E7EB',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#f3f4f6'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function createCityPieChart() {
            const ctx = document.getElementById('cityPieChart').getContext('2d');
            const cityCounts = {};
            
            currentData.forEach(item => {
                cityCounts[item.city] = (cityCounts[item.city] || 0) + 1;
            });

            charts.cityPie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(cityCounts),
                    datasets: [{
                        data: Object.values(cityCounts),
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createSupervisorPieChart() {
            const ctx = document.getElementById('supervisorPieChart').getContext('2d');
            const supervisorCounts = {};
            
            currentData.forEach(item => {
                supervisorCounts[item.supervisor] = (supervisorCounts[item.supervisor] || 0) + 1;
            });

            charts.supervisorPie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(supervisorCounts),
                    datasets: [{
                        data: Object.values(supervisorCounts),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        function createStatusDistributionChart() {
            const ctx = document.getElementById('statusDistributionChart').getContext('2d');
            
            charts.statusDistribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: overviewData.map(item => item.supervisor),
                    datasets: [{
                        label: 'Completed',
                        data: overviewData.map(item => item.completed),
                        backgroundColor: '#10B981',
                        borderRadius: 5
                    }, {
                        label: 'In Progress',
                        data: overviewData.map(item => item.inProgress),
                        backgroundColor: '#F59E0B',
                        borderRadius: 5
                    }, {
                        label: 'Not Completed',
                        data: overviewData.map(item => item.notCompleted),
                        backgroundColor: '#EF4444',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: '#f3f4f6'
                            }
                        }
                    }
                }
            });
        }

        function createTimelineChart() {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            
            // Sample timeline data
            const timelineData = [
                { month: 'Jan 2025', completed: 45 },
                { month: 'Feb 2025', completed: 52 },
                { month: 'Mar 2025', completed: 73 },
                { month: 'Apr 2025', completed: 89 },
                { month: 'May 2025', completed: 40 }
            ];

            charts.timeline = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timelineData.map(item => item.month),
                    datasets: [{
                        label: 'Completions',
                        data: timelineData.map(item => item.completed),
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderColor: '#667eea',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#f3f4f6'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function updateTable() {
            
            const tableBody = document.getElementById('studentTableBody');
            tableBody.innerHTML = '';

            if (currentData.length === 0) {
                const row = tableBody.insertRow();
                row.innerHTML = '<td colspan="8" style="text-align: center; padding: 40px; color: #666;">No data matches the current filters</td>';
                return;
            }

            currentData.forEach(student => {
                const row = tableBody.insertRow();
                
                const statusClass = student.status === 'Completed' ? 'status-completed' : 
                                   student.status === 'In Progress' ? 'status-progress' : 'status-not-completed';
                
                row.innerHTML = `
                    <td style="font-weight: 600;">${student.displayName}</td>
                    <td>${student.city}</td>
                    <td>${student.district}</td>
                    <td>${student.supervisor}</td>
                    <td style="font-size: 0.9em;">${student.username}</td>
                    <td style="font-weight: 600;"> ${student.completionRate > 0 ? (student.completionRate * 100).toFixed(1) + ' %' : '0 %'} </td>
                    <td><span class="status-badge ${statusClass}">${student.status}</span></td>
                    <td>${student.completedDate || '-'}</td>
                `;
            });
        }
    </script>
</body>
</html>
